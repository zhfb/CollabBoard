import{b as L,d as k,_ as N,u as se,a as j,w as T,i as K,p as te,c as re,e as oe,E as ae}from"./el-button-CasAo9RZ.js";import{s as C,E as ne}from"./socket-Bcpcqm-C.js";import{m as S,s as b,E as ie,a as le,b as de,c as M}from"./request-CoS7VfFU.js";import{d as E,c as g,o as f,a as R,b as p,n as _,u,r as B,e as w,t as $,f as q,i as ue,g as I,h as U,j as O,w as h,k as J,p as ce,l as A,m as z,q as fe,s as pe,F as x,v as H,x as G,y as he,z as m,A as me,B as ge,_ as ye}from"./index-DVYItPUN.js";import{u as be}from"./user-R25KWGKU.js";const ve=L({header:{type:String,default:""},footer:{type:String,default:""},bodyStyle:{type:k([String,Object,Array]),default:""},headerClass:String,bodyClass:String,footerClass:String,shadow:{type:String,values:["always","hover","never"],default:void 0}}),_e=E({name:"ElCard",__name:"card",props:ve,setup(s){const e=se("card"),t=j("card");return(r,o)=>{var a;return f(),g("div",{class:_([u(t).b(),u(t).is(`${r.shadow||((a=u(e))==null?void 0:a.shadow)||"always"}-shadow`)])},[r.$slots.header||r.header?(f(),g("div",{key:0,class:_([u(t).e("header"),r.headerClass])},[B(r.$slots,"header",{},()=>[w($(r.header),1)])],2)):R("v-if",!0),p("div",{class:_([u(t).e("body"),r.bodyClass]),style:q(r.bodyStyle)},[B(r.$slots,"default")],6),r.$slots.footer||r.footer?(f(),g("div",{key:1,class:_([u(t).e("footer"),r.footerClass])},[B(r.$slots,"footer",{},()=>[w($(r.footer),1)])],2)):R("v-if",!0)],2)}}});var we=N(_e,[["__file","/home/runner/work/element-plus/element-plus/packages/components/card/src/card.vue"]]);const ke=T(we),Be=L({tag:{type:String,default:"div"},span:{type:Number,default:24},offset:{type:Number,default:0},pull:{type:Number,default:0},push:{type:Number,default:0},xs:{type:k([Number,Object]),default:()=>S({})},sm:{type:k([Number,Object]),default:()=>S({})},md:{type:k([Number,Object]),default:()=>S({})},lg:{type:k([Number,Object]),default:()=>S({})},xl:{type:k([Number,Object]),default:()=>S({})}}),Q=Symbol("rowContextKey"),Ce=E({name:"ElCol",__name:"col",props:Be,setup(s){const e=s,{gutter:t}=ue(Q,{gutter:I(()=>0)}),r=j("col"),o=I(()=>{const i={};return t.value&&(i.paddingLeft=i.paddingRight=`${t.value/2}px`),i}),a=I(()=>{const i=[];return["span","offset","pull","push"].forEach(d=>{const n=e[d];K(n)&&(d==="span"?i.push(r.b(`${e[d]}`)):n>0&&i.push(r.b(`${d}-${e[d]}`)))}),["xs","sm","md","lg","xl"].forEach(d=>{K(e[d])?i.push(r.b(`${d}-${e[d]}`)):U(e[d])&&Object.entries(e[d]).forEach(([n,y])=>{i.push(n!=="span"?r.b(`${d}-${n}-${y}`):r.b(`${d}-${y}`))})}),t.value&&i.push(r.is("guttered")),[r.b(),i]});return(i,l)=>(f(),O(J(i.tag),{class:_(a.value),style:q(o.value)},{default:h(()=>[B(i.$slots,"default")]),_:3},8,["class","style"]))}});var $e=N(Ce,[["__file","/home/runner/work/element-plus/element-plus/packages/components/col/src/col.vue"]]);const Ie=T($e),Ee=["start","center","end","space-around","space-between","space-evenly"],Se=["top","middle","bottom"],Le=L({tag:{type:String,default:"div"},gutter:{type:Number,default:0},justify:{type:String,values:Ee,default:"start"},align:{type:String,values:Se}}),Ne=E({name:"ElRow",__name:"row",props:Le,setup(s){const e=s,t=j("row"),r=I(()=>e.gutter);ce(Q,{gutter:r});const o=I(()=>{const i={};return e.gutter&&(i.marginRight=i.marginLeft=`-${e.gutter/2}px`),i}),a=I(()=>[t.b(),t.is(`justify-${e.justify}`,e.justify!=="start"),t.is(`align-${e.align}`,!!e.align)]);return(i,l)=>(f(),O(J(i.tag),{class:_(a.value),style:q(o.value)},{default:h(()=>[B(i.$slots,"default")]),_:3},8,["class","style"]))}});var je=N(Ne,[["__file","/home/runner/work/element-plus/element-plus/packages/components/row/src/row.vue"]]);const Oe=T(je),Ve=L({animated:Boolean,count:{type:Number,default:1},rows:{type:Number,default:3},loading:{type:Boolean,default:!0},throttle:{type:k([Number,Object])}}),Me=L({variant:{type:String,values:["circle","rect","h1","h3","text","caption","p","image","button"],default:"text"}}),xe=E({name:"ElSkeletonItem",__name:"skeleton-item",props:Me,setup(s){const e=j("skeleton");return(t,r)=>(f(),g("div",{class:_([u(e).e("item"),u(e).e(t.variant)])},[t.variant==="image"?(f(),O(u(te),{key:0})):R("v-if",!0)],2))}});var P=N(xe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/skeleton/src/skeleton-item.vue"]]);const Re=(s,e=0)=>{if(e===0)return s;const t=U(e)&&!!e.initVal,r=A(t);let o=null;const a=l=>{if(re(l)){r.value=s.value;return}o&&clearTimeout(o),o=setTimeout(()=>{r.value=s.value},l)},i=l=>{l==="leading"?K(e)?a(e):a(e.leading):U(e)?a(e.trailing):r.value=!1};return z(()=>i("leading")),fe(()=>s.value,l=>{i(l?"leading":"trailing")}),r},Pe=E({name:"ElSkeleton",__name:"skeleton",props:Ve,setup(s,{expose:e}){const t=s,r=j("skeleton"),o=Re(pe(t,"loading"),t.throttle);return e({uiLoading:o}),(a,i)=>u(o)?(f(),g("div",G({key:0,class:[u(r).b(),u(r).is("animated",a.animated)]},a.$attrs),[(f(!0),g(x,null,H(a.count,l=>(f(),g(x,{key:l},[u(o)?B(a.$slots,"template",{key:l},()=>[m(P,{class:_(u(r).is("first")),variant:"p"},null,8,["class"]),(f(!0),g(x,null,H(a.rows,c=>(f(),O(P,{key:c,class:_([u(r).e("paragraph"),u(r).is("last",c===a.rows&&a.rows>1)]),variant:"p"},null,8,["class"]))),128))]):R("v-if",!0)],64))),128))],16)):B(a.$slots,"default",he(G({key:1},a.$attrs)))}});var Te=N(Pe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/skeleton/src/skeleton.vue"]]);const Fe=T(Te,{SkeletonItem:P});oe(P);const Ke=me("kanban",{state:()=>({boards:[],currentBoard:null,loading:!1,error:null}),getters:{getBoardById:s=>e=>s.boards.find(t=>t.id===e),getListsByBoardId:s=>e=>{const t=s.boards.find(r=>r.id===e);return t?t.lists:[]},getCardsByListId:s=>e=>{for(const t of s.boards)for(const r of t.lists)if(r.id===e)return r.cards;return[]}},actions:{async fetchBoards(){this.loading=!0,this.error=null;try{const s=await b.get("/boards");return this.boards=s.data,s.data}catch(s){throw this.error=s.message||"获取看板失败",s}finally{this.loading=!1}},async fetchBoard(s){this.loading=!0,this.error=null;try{const e=await b.get(`/boards/${s}`);this.currentBoard=e.data;const t=this.boards.findIndex(r=>r.id===s);return t!==-1?this.boards[t]=e.data:this.boards.push(e.data),e.data}catch(e){throw this.error=e.message||"获取看板详情失败",e}finally{this.loading=!1}},async createBoard(s){this.loading=!0,this.error=null;try{const e=await b.post("/boards",s);return this.boards.push(e.data),this.currentBoard=e.data,e.data}catch(e){throw this.error=e.message||"创建看板失败",e}finally{this.loading=!1}},async updateBoard(s,e){var t;this.loading=!0,this.error=null;try{const r=await b.put(`/boards/${s}`,e),o=this.boards.findIndex(a=>a.id===s);return o!==-1&&(this.boards[o]={...this.boards[o],...r.data}),((t=this.currentBoard)==null?void 0:t.id)===s&&(this.currentBoard={...this.currentBoard,...r.data}),r.data}catch(r){throw this.error=r.message||"更新看板失败",r}finally{this.loading=!1}},async deleteBoard(s){var e;this.loading=!0,this.error=null;try{await b.delete(`/boards/${s}`),this.boards=this.boards.filter(t=>t.id!==s),((e=this.currentBoard)==null?void 0:e.id)===s&&(this.currentBoard=null)}catch(t){throw this.error=t.message||"删除看板失败",t}finally{this.loading=!1}},async createList(s){var e;this.loading=!0,this.error=null;try{const t=await b.post("/lists",s),r=this.boards.findIndex(o=>o.id===s.board_id);return r!==-1&&this.boards[r].lists.push({...t.data,cards:[]}),((e=this.currentBoard)==null?void 0:e.id)===s.board_id&&this.currentBoard.lists.push({...t.data,cards:[]}),t.data}catch(t){throw this.error=t.message||"创建列表失败",t}finally{this.loading=!1}},async updateList(s,e){this.loading=!0,this.error=null;try{const t=await b.put(`/lists/${s}`,e);for(const r of this.boards){const o=r.lists.findIndex(a=>a.id===s);o!==-1&&(r.lists[o]={...r.lists[o],...t.data})}if(this.currentBoard){const r=this.currentBoard.lists.findIndex(o=>o.id===s);r!==-1&&(this.currentBoard.lists[r]={...this.currentBoard.lists[r],...t.data})}return t.data}catch(t){throw this.error=t.message||"更新列表失败",t}finally{this.loading=!1}},async deleteList(s){this.loading=!0,this.error=null;try{await b.delete(`/lists/${s}`);for(const e of this.boards)e.lists=e.lists.filter(t=>t.id!==s);this.currentBoard&&(this.currentBoard.lists=this.currentBoard.lists.filter(e=>e.id!==s))}catch(e){throw this.error=e.message||"删除列表失败",e}finally{this.loading=!1}},async createCard(s){this.loading=!0,this.error=null;try{const e=await b.post("/cards",s);for(const t of this.boards)for(const r of t.lists)if(r.id===s.list_id){r.cards.push(e.data),r.cards.sort((o,a)=>o.order-a.order);break}return e.data}catch(e){throw this.error=e.message||"创建卡片失败",e}finally{this.loading=!1}},async updateCard(s,e){this.loading=!0,this.error=null;try{const t=await b.put(`/cards/${s}`,e);for(const r of this.boards)for(const o of r.lists){const a=o.cards.findIndex(i=>i.id===s);if(a!==-1){if(e.list_id&&e.list_id!==o.id){const[i]=o.cards.splice(a,1),l=r.lists.find(c=>c.id===e.list_id);l&&(l.cards.push({...i,...t.data}),l.cards.sort((c,d)=>c.order-d.order))}else o.cards[a]={...o.cards[a],...t.data},o.cards.sort((i,l)=>i.order-l.order);break}}return t.data}catch(t){throw this.error=t.message||"更新卡片失败",t}finally{this.loading=!1}},async deleteCard(s){this.loading=!0,this.error=null;try{await b.delete(`/cards/${s}`);for(const e of this.boards)for(const t of e.lists)t.cards=t.cards.filter(r=>r.id!==s)}catch(e){throw this.error=e.message||"删除卡片失败",e}finally{this.loading=!1}},async updateCardOrder(s,e,t){try{await this.updateCard(s,{list_id:e,order:t})}catch(r){throw console.error("更新卡片顺序失败:",r),r}},async updateListOrder(s,e){try{await this.updateList(s,{order:e})}catch(t){throw console.error("更新列表顺序失败:",t),t}},handleDragEnd(s){const{to:e,from:t,draggable:r,oldIndex:o,newIndex:a}=s;if(r.classList.contains("card")){parseInt(r.dataset.id);const i=parseInt(t.dataset.listId),l=parseInt(e.dataset.listId);if(i!==l){if(this.currentBoard){const c=this.currentBoard.lists.find(n=>n.id===i),d=this.currentBoard.lists.find(n=>n.id===l);if(c&&d){const[n]=c.cards.splice(o,1);n.list_id=l,d.cards.splice(a,0,n),d.cards.forEach((y,V)=>{y.order=V,this.updateCardOrder(y.id,l,V)}),this.emitCardMoved(n)}}}else if(this.currentBoard){const c=this.currentBoard.lists.find(d=>d.id===i);if(c){const[d]=c.cards.splice(o,1);c.cards.splice(a,0,d),c.cards.forEach((n,y)=>{n.order=y,this.updateCardOrder(n.id,i,y)}),this.emitCardMoved(d)}}}else if(r.classList.contains("list")&&(parseInt(r.dataset.id),this.currentBoard)){const[i]=this.currentBoard.lists.splice(o,1);this.currentBoard.lists.splice(a,0,i),this.currentBoard.lists.forEach((l,c)=>{l.order=c,this.updateListOrder(l.id,c)}),this.emitListMoved(i)}},initSocket(){C.connected||C.connect(),C.on("card:moved",s=>{this.handleCardMovedEvent(s)}),C.on("list:moved",s=>{this.handleListMovedEvent(s)})},emitCardMoved(s){C.emit("card:moved",{card_id:s.id,list_id:s.list_id,order:s.order})},emitListMoved(s){C.emit("list:moved",{list_id:s.id,board_id:s.board_id,order:s.order})},handleCardMovedEvent(s){for(const e of this.boards)for(const t of e.lists){const r=t.cards.findIndex(o=>o.id===s.card_id);if(r!==-1){if(s.list_id!==t.id){const[o]=t.cards.splice(r,1),a=e.lists.find(i=>i.id===s.list_id);a&&(o.list_id=s.list_id,o.order=s.order,a.cards.push(o),a.cards.sort((i,l)=>i.order-l.order))}else t.cards[r].order=s.order,t.cards.sort((o,a)=>o.order-a.order);break}}},handleListMovedEvent(s){for(const e of this.boards)if(e.id===s.board_id){const t=e.lists.findIndex(r=>r.id===s.list_id);t!==-1&&(e.lists[t].order=s.order,e.lists.sort((r,o)=>r.order-o.order));break}}}}),Ue={class:"home-container"},Ae={class:"header"},He={class:"content"},qe={key:0,class:"user-info"},Ge={key:1},Je={key:0,class:"boards-list"},ze={key:1,class:"no-boards"},Qe={class:"dialog-footer"},We=E({__name:"HomeView",setup(s){const e=be(),t=Ke(),r=ge(),o=A(!1),a=A({title:""});z(async()=>{e.isLogin&&(e.userInfo||await e.getUserInfo(),await t.fetchBoards())});const i=()=>{e.logout(),M.success("已退出登录")},l=d=>{r.push(`/board/${d}`)},c=async()=>{var d;if(!a.value.title.trim()){M.warning("请输入看板名称");return}try{await t.createBoard({title:a.value.title,user_id:((d=e.userInfo)==null?void 0:d.id)||1}),M.success("看板创建成功"),o.value=!1,a.value.title=""}catch{M.error("创建看板失败")}};return(d,n)=>{const y=ae,V=Fe,F=ke,W=Ie,X=Oe,Y=de,Z=le,D=ie,ee=ne;return f(),g("div",Ue,[p("div",Ae,[n[6]||(n[6]=p("h1",{class:"title"},"欢迎回来！",-1)),p("div",null,[m(y,{type:"primary",onClick:n[0]||(n[0]=v=>o.value=!0)},{default:h(()=>[...n[4]||(n[4]=[w("创建看板",-1)])]),_:1}),m(y,{onClick:i},{default:h(()=>[...n[5]||(n[5]=[w("退出登录",-1)])]),_:1})])]),p("div",He,[m(F,{class:"user-card"},{header:h(()=>[...n[7]||(n[7]=[p("div",{class:"card-header"},[p("span",null,"用户信息")],-1)])]),default:h(()=>[u(e).userInfo?(f(),g("div",qe,[p("p",null,[n[8]||(n[8]=p("strong",null,"用户名：",-1)),w($(u(e).userInfo.username),1)]),p("p",null,[n[9]||(n[9]=p("strong",null,"邮箱：",-1)),w($(u(e).userInfo.email),1)])])):(f(),g("div",Ge,[m(V,{rows:3,animated:""})]))]),_:1}),m(F,{class:"boards-card"},{header:h(()=>[...n[10]||(n[10]=[p("div",{class:"card-header"},[p("span",null,"我的看板")],-1)])]),default:h(()=>[u(t).boards.length>0?(f(),g("div",Je,[m(X,{gutter:20},{default:h(()=>[(f(!0),g(x,null,H(u(t).boards,v=>(f(),O(W,{xs:24,sm:12,md:8,lg:6,key:v.id},{default:h(()=>[m(F,{class:"board-item",onClick:Xe=>l(v.id)},{default:h(()=>[p("h3",null,$(v.title),1),p("p",null,$(v.lists.length)+" 个列表",1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):(f(),g("div",ze,[...n[11]||(n[11]=[p("p",null,"您还没有创建任何看板，点击右上角按钮创建第一个看板吧！",-1)])]))]),_:1})]),m(ee,{modelValue:o.value,"onUpdate:modelValue":n[3]||(n[3]=v=>o.value=v),title:"创建看板",width:"30%"},{footer:h(()=>[p("span",Qe,[m(y,{onClick:n[2]||(n[2]=v=>o.value=!1)},{default:h(()=>[...n[12]||(n[12]=[w("取消",-1)])]),_:1}),m(y,{type:"primary",onClick:c},{default:h(()=>[...n[13]||(n[13]=[w("确定",-1)])]),_:1})])]),default:h(()=>[m(D,{model:a.value,"label-position":"top"},{default:h(()=>[m(Z,{label:"看板名称"},{default:h(()=>[m(Y,{modelValue:a.value.title,"onUpdate:modelValue":n[1]||(n[1]=v=>a.value.title=v),placeholder:"请输入看板名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ts=ye(We,[["__scopeId","data-v-f4f918be"]]);export{ts as default};
